/* Modified: October 9, 2014, 11:07:12 */
!function () {
    function a(a) {
        if (a.region === f) {
            d.textContent = a.region;
            var b = k.nodes(c(a)).filter(function (a) {
                return!a.children
            }), e = j.selectAll("circle").data(b, function (a) {
                return a.name
            }), g = 200, h = 0;
            e.transition().duration(g).delay(function (a, b) {
                return h = 7 * b
            }).attr("transform", function (a) {
                return"translate(" + a.x + "," + a.y + ")"
            }).attr("r", function (a) {
                return a.r
            }).style("opacity", 1), e.enter().append("circle").attr("transform", function (a) {
                return"translate(" + a.x + "," + a.y + ")"
            }).attr("r", function (a) {
                return a.r
            }).attr("class", function (a) {
                return a.className
            }).style("opacity", 0).transition().duration(1.2 * g).style("opacity", 1), e.exit().transition().duration(g + h).style("opacity", 0).remove()
        }
    }

    function b() {
        m.subscribe({channel: l, callback: function (b) {
            a(b)
        }})
    }

    function c(a) {
        if (a) {
            var b = a.countries_msg_vol, c = [];
            for (var d in b)c.push({name: d, className: d.toLowerCase().replace(/ /g, ""), size: b[d]});
            return{children: c}
        }
    }

    var d = document.getElementById("region"), e = document.getElementById("dataCenterPicker"), f = e.options[e.selectedIndex].value;
    e.addEventListener("change", function () {
        f = e.options[e.selectedIndex].value, console.log(f)
    }, !1);
    var g = !0, h = document.getElementById("toggle");
    h.addEventListener("click", function () {
        g ? (m.unsubscribe({channel: l}), h.value = "Stream again", g = !1) : (b(), h.value = "Stop me!", g = !0)
    }, !1);
    var i = Math.min(document.getElementById("chart").clientWidth, window.innerHeight - document.querySelector("header").clientHeight) - 20, j = d3.select("#chart").append("svg").attr("width", i).attr("height", i), k = d3.layout.pack().size([i, i]).value(function (a) {
        return a.size
    }).padding(3), l = "rts-xNjiKP4Bg4jgElhhn9v9", m = PUBNUB.init({subscribe_key: "e19f2bb0-623a-11df-98a1-fbd39d75aa3f"});
    b()
}();